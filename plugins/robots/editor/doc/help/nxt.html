<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="TRIKStudio, help, manual, user guide" />
<meta name="description" content="TRIKStudio help center" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Программирование Lego NXT в TRIKStudio</title>
<link href="style.css" rel="stylesheet" type="text/css" media="screen" />
<script type="text/javascript" src="version.js"></script>
</head>

<body>
<div id="wrapper">
	<script type="text/javascript" src="header.html.js"></script>
	<div id="page" class="container">
		<div id="sidebar">
			<script type="text/javascript" src="contents.html.js"></script>
		</div>
		<div id="content">
			<div class="post">
				<h2 class="title">Программирование Lego NXT в TRIKStudio<a href="#"></a></h2>
				<div class="entry">
					<p></p>
				</div>
			</div>

			<h3><a name="connection">Подключение робота</a></h3>

			<p>
			Первое, что необходимо сделать для программирования Lego NXT – переключить TRIKStudio в режим поддержки Lego NXT. Это делается в окне "Настройки", вкладка "Роботы":
			</p>

			<center><img src="pics/nxt/kit-selection.png" alt="Выбор конструктора Lego NXT" width="660"></center>

			<h4>Подключение по USB</h4>

			<p>
			Задайте в окне настроек робота подключение по USB, нажмите "ОК".
			</p>

			<center><img src="pics/nxt/select-connection-type.png" alt="Выбор способа соединения" width="660" height="420"></center>

			<p>
			Нажмите кнопку "Подключиться" на панели инструментов.
			</p>

			<center><img src="pics/nxt/connect.png" alt="Кнопка подключения"></center>

			<p>
			В случае, если драйвер для работы с NXT по USB не установлен на компьютер или установлен некорректно (как это часто бывает в случае с официальным драйвером Lego Fantom на последних версиях Windows), TRIK Studio предложит установить собственный драйвер. Следуйте дальнейшим инструкциям, которые будут даны в процессе установки. Официальный драйвер NXT также совместим с TRIK Studio, см. раздел<a href="#nxt-fantom-installation">"Установка драйвера Lego Fantom"</a>.
			</p>

			<p>
			В окне вывода должно появиться сообщение об успешном подключении, после этого робот готов к работе.
			</p>

			<center><img src="pics/nxt/connection-success.png" alt="Успешное подключение"></center>

			<h4>Подключение по Bluetooth</h4>

			<p>
			Робот подключается к компьютеру по Bluetooth как обычное Bluetooth-устройство, поэтому, во-первых, никаких специальных драйверов робота для подключения не требуется, во-вторых, процесс
			подключения сильно зависит как от операционной системы, так и от драйверов конкретного Bluetooth-адаптера. Ниже приведены инструкции по настройке подключения для Windows Vista с
			использованием встроенных в ОС драйверов для Generic Bluetooth Radio.
			</p>

			<ol>
				<li> Включить робот </li>
				<li> В "панели управления" операционной системы надо найти значок "Устройства Bluetooth"</li>
				<li> Нажать "Добавление беспроводного устройства" </li>
				<li> Выбрать в появившемся окне устройство "NXT" </li>
				<li> Нажать на роботе оранжевую кнопку, подтвердив пароль <i><b>1234</b></i> на Bluetooth-соединение</li>
				<li> В появившемся на компьютере окне ввести код <b><i>1234</b></i> и нажать "Далее"</li>
				<li> Нажать "Закрыть"</li>
				<li> Правой кнопкой мыши кликнуть по значку устройства, выбрать пункт меню "Свойства"</li>
				<li> В появившемся окне перейти на вкладку "Службы" и запомнить номер последовательного порта (например, <i>COM7</i>)</li>
				<li> Закрыть окно и панель управления, теперь робот подключен как Bluetooth-устройство, надо настроить TRIKStudio</li>
				<li> Запустить TRIKStudio, открыть окно настроек робота</li>
				<li> Выбрать подключение по Bluetooth и реальный робот</li>
				<li> В разделе "Настройки Bluetooth" указать номер COM-порта, который был написан во вкладке "Службы" (например, <i>COM7</i>)</li>
				<li> Нажать "ОК"</li>
			</ol>

			<p>
			А вот так выполняется подключение в Windows 8.1 со стандартным драйвером Bluetooth. Сначала на панели, появляющейся у правого края экрана надо выбрать "Параметры":
			</p>

			<center><img src="pics/nxt/8-sidebar.png" alt="Выбор пункта 'Параметры'"></center>

			<p>
			Там выбираем "Изменение параметров компьютера":
			</p>

			<center><img src="pics/nxt/8-sidebar-2.png" alt="Выбор пункта 'Изменение параметров компьютера'"></center>

			<p>
			В появившемся окне выбираем "Компьютер и устройства":
			</p>

			<center><img src="pics/nxt/8-parameters.png" alt="Выбор 'Компьютер и устройства'"></center>

			<p>
			Там выбираем "Bluetooth" и находим в списке Bluetooth-устройств устройство с именем NXT (заполнение списка может занять некоторое время):
			</p>

			<center><img src="pics/nxt/8-bluetooth.png" alt="Выбор 'Bluetooth'"></center>

			<p>
			Жмём кнопку "Связать", на роботе в это время должен отобразиться ввод пароля Bluetooth-соединения. Можно оставить пароль по умолчанию и нажать оранжевую кнопку. После этого окно ввода пароля должно появиться
			и на компьютере. Пароль по умолчанию – 1234:
			</p>

			<center><img src="pics/nxt/8-password.png" alt="Ввод пароля"></center>

			<p>
			Если всё было сделано правильно, рядом с именем устройства должна появиться надпись "Подключено":
			</p>

			<center><img src="pics/nxt/8-bluetooth-connected.png" alt="Подключено"></center>

			<p>
			После этого можно проделать следующие пункты:
			<ol>
				<li> Запустить TRIKStudio, открыть окно настроек робота</li>
				<li> Выбрать подключение по Bluetooth и реальный робот</li>
				<li> В разделе "Настройки Bluetooth" выбрать один из COM-портов из выпадающего списка (например, <i>COM7</i>)</li>
				<li> Нажать "ОК"</li>
				<li> Попробовать выполнить подключение к роботу с посощью кнопки "Подключиться" на панели инструментов</li>
				<li> Если подключение не удалось, попробовать другой COM-порт в настройках</li>
			</ol>
			</p>

			<p>
			См. также раздел <a href="interface.html#robotSettings">Диалог настроек робота</a>.
			</p>

			<h3><a name="nxt-fantom-installation">Установка драйвера Lego Fantom</a></h3>

			<p>
			Для управления роботом прямыми командами по USB и для загрузки программ на робот потребуются драйвера из поставки конструктора. Скачать их отдельно можно с сайта Lego:
			<a href="http://www.lego.com/ru-ru/mindstorms/downloads">http://www.lego.com/ru-ru/mindstorms/downloads</a>, "Загрузить драйвер NXT Fantom". Если при установке возникнут проблемы,
			можно в распакованном архиве с драйвером перейти в папку "NXT Fantom Drivers\NXT Fantom Drivers\Windows\1.2\1.2.0\Products", выбрать там нужный драйвер и запустить соответствующий .msi-файл вручную
			(например, для 64-битной Windows 8.1 это "NXT Fantom Drivers\NXT Fantom Drivers\Windows\1.2\1.2.0\Products\LEGO_NXT_Driver_64\NXT_D02\LegoMindstormsNXTdriver64.msi"). Информацию об установке
			драйвера NXT можно уточнить на сайте Lego или в сторонних источниках, авторы данной документации не связаны с Lego и не могут влиять на то, как Lego распространяет драйвера. После установки драйверов TRIK Studio сможет подключаться к роботу.
			</p>

			<h3><a name="nxt-ts-driver-manual-installation">Установка драйвера NXT вручную</a></h3>
			
			<p>
			В случае, если по какой-либо причине автоматическая установка драйвера TRIK Studio была неудачной, Вы можете попробовать установить драйвер вручную. Здесь будет описан процесс установки драйвера на Windows 8.1, на других версиях Windows последовательность действий аналогична.
			Прежде всего, следует помнить, что устройство NXT может находиться в двух режимах: прошитом и со стертой прошивкой (в таком случае NXT будет издавать повторяющиеся звуковые сигналы, "тикать"). Следует также иметь в виду, что в течение всего времени выполнения инструкций данного раздела устройство NXT должно быть включено и подключено к компьютеру. Откройте диспетчер устройств Windows и найдите в нем секцию с неизвестными устройствами (их количество может быть разным на разных компьютерах):
			</p>

			<center><img src="pics/nxt/windows-device-manager-unknown-section.png" alt="Секция с неизвестными устройствами"></center>
			
			<p>
			Следующее, что следует сделать&nbsp;&mdash;&nbsp;запомнить идентификаторы поставщика и устройства NXT в том режиме, в котором он в данный момент находится. В случае, если NXT не прошит и "тикает", идентификатором поставщика является <b>03EB</b>, идентификатором устройства&nbsp;&mdash;&nbsp;<b>6124</b>. Для прошитого NXT такими идентификаторами будут <b>0694</b> для производителя и <b>0002</b> для устройства.<br/>
			Далее необходимо найти устройство с такими идентификаторами. Для этого последовательно сверяйте идентификаторы каждого неизвестного устройства в диспетчере устройств. Идентификаторы можно посмотреть в окне свойств устройства, для этого кликните правой кнопкой мыши по устройству, выберите пункт <i>Свойства</i>, в открывшемся окне кликните на вкладку <i>Сведения</i> и в раскрывающемся списке свойств выберите <i>ИД оборудования</i>:
			</p>
			
			<center><img src="pics/nxt/windows-device-manager-id-window.png" alt="Окно с идентификаторами оборудования"></center>

			<p>
			Значение свойства для устройства NXT должно содержать строку вида <b>USB\VID_<i>&lt;ИД производителя&gt;</i>&PID_<i>&lt;ИД оборудования&gt;</i></b>, где вместо <i>&lt;ИД производителя&gt;</i> и <i>&lt;ИД оборудования&gt;</i> стоят запомненные на предыдущем шаге числа.<br/>
			Если такого устройства не нашлось в секции неизвестных устройств, следует проверить другие секции, в первую очередь, не установлено ли устроство <i>Bossa Program Port</i> в секции <i>Порты (COM и LPT)</i>. Если такое устройство есть, следует удалить его драйвер и начать процесс установки с начала, перевоткнув в компьютер устройство NXT.
			</p>

			<p>
			Как только устройство NXT найдено, можно установить на него драйвер WinUSB. Для этого закройте окно со свойствами устройства, если оно открыто, кликните правой кнопкой мыши по найденному на предыдущем шаге устройству и выберите пункт <i>Обновить драйверы...</i>. В открывшемся окне выберите пункт "Выполнить поиск драйверов на этом компьютере":
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-1.png" alt="Пункт выбора драйвера вручную"></center>

			<p>
			Далее нажмите "Выбрать драйвер из списка уже установленных драйверов":
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-2.png" alt="Пункт выбора драйвера из списка"></center>

			<p>
			Нужный нам драйвер находится в категории "Устройства USB":
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-3.png" alt="Выбор категории Устройства USB"></center>

			<p>
			В списке "Изготовитель" выберите "WinUsb Device" и пункт с таким же названием в списке "Модель":
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-4.png" alt="Выбор драйвера WinUSB"></center>

			<p>
			Появится предупреждающее сообщение Windows о том, что устройство может не работать с данным драйвером. Подтвердите свой выбор:
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-5.png" alt="Подтверждение установки драйвера WinUSB"></center>

			<p>
			Сам процесс установки обычно проходит довольно быстро, после чего будет показано окно с оповещением об успешной установке драйвера. Это означает, что среда TRIK Studio готова к работе с NXT. Следует иметь в виду, что другое ПО на компьютере, работающее с NXT, скорее всего, перестанет работать с ним, так как теперь драйвером устройства NXT в системе является WinUSB, а не Lego Fantom. Аналогичную процедуру следует проделать при переводе NXT в другой режим (его прошивке или удалении прошивки клавишей "reset").
			</p>

			<center><img src="pics/nxt/windows-device-manager-install-6.png" alt="Успешная установка драйвера WinUSB"></center>
			
			<h3><a name="flashing">Прошивка робота</a></h3>

			<p>
			TRIK Studio в качестве среды выполнения сгенерированных программ использует прошивку nxtOSEK (<a href="http://lejos-osek.sourceforge.net/">http://lejos-osek.sourceforge.net/</a>), совместимую по формату
			команд и внешнему виду интерфейса с штатной прошивкой, но позволяющую запускать программы на C с библиотекой ECRobot. Перед тем, как загружать на робот сгенерированные программы, робот необходимо прошить
			(сделать это надо только один раз для каждого робота, если не используется сторонних средств, загружающих на робот свои прошивки).
			</p>

			<p>
			Так же, как и для подключения по USB, прошивка робота требует установленных драйверов.
			Первое, что требуется сделать – перевести робот в режим прошивания, для этого надо включить робот, подключить его к компьютеру по USB, после чего чем-нибудь тонким (скрепкой, стержнем от ручки)
			нажать на кнопку Reset сзади робота и подержать 4 секунды (подробнее об этом см. в инструкции по эксплуатации робота, поставляемой вместе с конструктором). Если всё сделано правильно,
			робот будет характерно тикать. После этого необходимо нажать на кнопку "Прошить" и подождать, пока система сообщит об удачном завершении прошивания робота. После этого робот можно выключить
			и снова включить, загрузится новая прошивка.
			</p>

			<h3><a name="blocks">Блоки Lego NXT</a></h3>

			<p>
			Специализированные блоки для Lego NXT делятся на несколько категорий:
			</p>

			<ul>
				<li><b><a href="#nxt-functional-blocks">Действия</a></b> – блоки, выполняющие какое-либо действие на роботе: включение моторов, проигрывание звука и т.д.</li>
				<li><b><a href="#nxt-waiting-blocks">Ожидания</a></b> – блоки, ждущие наступления какого-либо события: определённых показаний датчиков, нажатия на кнопку и т.д.</li>
				<li><b><a href="#nxt-drawing-blocks">Рисования на дисплее</a></b> – блоки, используемые для вывода графики и текста на экран.</li>
			</ul>

			<h4><a name="nxt-functional-blocks">Действия</a></h4>

			<table cellspacing="2" border="1" cellpadding="5" width="800" >
				<tr>
					<td><b>Название элемента</b></td>
					<td><b>Пиктограмма</b></td>
					<td><b>Описание</b></td>
				</tr>
				<tr>
					<td>Гудок</td>
					<td><center><img src="pics/nxt/beep.png" alt="Гудок"></center></td>
					<td>Проиграть на роботе звук с фиксированной частотой. Имеется один параметр — ждать ли завершения проигрывания звука или сразу же перейти к следующему блоку. Допустимые значения — Истина и Ложь.</td>
				</tr>
				<tr>
					<td>Играть звук</td>
					<td><center><img src="pics/nxt/playTone.png" alt="Играть звук"></center></td>
					<td>Проиграть на роботе звук с заданной частотой и длительностью. Аналогичен блоку "Гудок", но позволяет задавать параметры звука. Имеется параметр, определяющий, ждать ли завершения проигрывания звука или сразу же перейти к следующему блоку. </td>
				</tr>
				<tr>
					<td>Моторы вперёд</td>
					<td><center><img src="pics/nxt/enginesForward.png" alt="Моторы вперёд"></center></td>
					<td>Включить моторы по заданным портам с заданной мощностью. Порты задаются буквами A, B или C, разделенными запятыми. Мощность задается в процентах числом от -100 до 100, если задано отрицательное значение, мотор включается в режиме реверса. Так, на картинке изображена команда включения моторов на портах A и B с мощностью 100%. Кроме того, моторы имеют разные режимы работы: режим торможения и режим скольжения (отображаемые красным или зелёным прямоугольником на блоке соответственно). Режимы влияют на то, как двигатель отрабатывает команду — режим торможения стопорит двигатель при отключении, режим скольжения позволяет двигателю прокручиваться по инерции.
					</td>
				</tr>
				<tr>
					<td>Моторы назад</td>
					<td><center><img src="pics/nxt/enginesBackward.png" alt="Моторы назад"></center></td>
					<td>Включить моторы в режиме реверса по заданным портам с заданной мощностью. Параметры аналогичны параметрами блока "Моторы вперёд".</td>
				</tr>
				<tr>
					<td>Моторы стоп</td>
					<td><center><img src="pics/nxt/enginesStop.png" alt="Моторы стоп"></center></td>
					<td>Выключить моторы по заданным портам.</td>
				</tr>
				<tr>
					<td>Сбросить показания энкодера</td>
					<td><center><img src="pics/nxt/clearEncoder.png" alt="Сбросить показания энкодера"></center></td>
					<td>Сбросить показания количества оборотов моторов.</td>
				</tr>
			</table>

			<br/>

			<h4><a name="nxt-waiting-blocks">Ожидания</a></h4>

			<table cellspacing="2" border="1" cellpadding="5" width="800" >
				<tr>
					<td><b>Название элемента</b></td>
					<td><b>Пиктограмма</b></td>
					<td><b>Описание</b></td>
				</tr>
				<tr>
					<td>Ждать сенсор касания</td>
					<td><center><img src="pics/nxt/waitTouch.png" alt="Ждать сенсор касания"></center></td>
					<td>Ждать, пока не сработает датчик касания. Параметром указывается номер порта, к которому подключен датчик. Допустимые значения: 1, 2, 3, 4.</td>
				</tr>
				<tr>
					<td>Ждать сонар</td>
					<td><center><img src="pics/nxt/waitSonar.png" alt="Ждать сонар"></center></td>
					<td>Ждать, пока расстояние, возвращаемое ультразвуковым сенсором расстояния, не будет сравнимо с указанным в значении параметра "Расстояние" (расстояние задается в сантиметрах, от 0 до 255). Еще один парамер — номер порта, к которому подключен датчик расстояния. Также параметром указывается операция, которая будет использоваться для сравнения с введенным расстоянием. Так, при выполнении приведенного блока выполнение программы остановится до тех пор, пока значение, возвращаемое сонаром, не будет больше, чем 40 см.</td>
				</tr>
				<tr>
					<td>Ждать цвет</td>
					<td><center><img src="pics/nxt/waitColor.png" alt="Ждать цвет"></center></td>
					<td>Ждать, пока сенсор цвета в режиме распознавания цветов не вернет указанный цвет.</td>
				</tr>
				<tr>
					<td>Ждать энкодер</td>
					<td><center><img src="pics/nxt/waitEncoder.png" alt="Ждать энкодер"></center></td>
					<td>Ждать, пока показания счетчика количества оборотов на заданном моторе не достинут указанного в значении параметра "Предел оборотов".</td>
				</tr>
				<tr>
					<td>Ждать интенсивность цвета</td>
					<td><center><img src="pics/nxt/waitLightIntensity.png" alt="Ждать интенсивность цвета"></center></td>
					<td>Ждать, пока значение, возвращаемое сенсором цвета на указанном порту, не будет сравнимо с указанным в значении параметра "Интенсивность" (задается в процентах). Еще один парамер — номер порта, к которому подключен сенсор цвета. Также параметром указывается операция, которая будет использоваться для сравнения с введенной интенсивностью. Так, при выполнении приведенного блока выполнение программы остановится до тех пор, пока значение, возвращаемое соответствующим сенсором цвета, не будет больше, чем 60 процентов.</td>
				</tr>
				<tr>
					<td>Ждать свет</td>
					<td><center><img src="pics/nxt/waitLight.png" alt="Ждать свет"></center></td>
					<td>Ждать, пока значение, возвращаемое сенсором света на указанном порту, не будет сравнимо с указанным в значении параметра "Проценты". Еще один парамер — номер порта, к которому подключен сенсор цвета. Также параметром указывается операция, которая будет использоваться для сравнения со значением параметра "Проценты". Так, при выполнении приведенного блока выполнение программы остановится до тех пор, пока значение, возвращаемое соответствующим сенсором света, не будет больше, чем 60 процентов.</td>
				</tr>
				<tr>
					<td>Ждать сенсор звука</td>
					<td><center><img src="pics/nxt/waitSound.png" alt="Ждать сенсор звука"></center></td>
					<td>Ждать, пока громкость, считанная микрофоном на заданном порту, не будет выше или ниже заданного значения.</td>
				</tr>
				<tr>
					<td>Ждать нажатия кнопки</td>
					<td><center><img src="pics/nxt/waitForButton.png" alt="Ждать нажатия кнопки"></center></td>
					<td>Ждать, пока не будет нажата указанная кнопка на корпусе робота. Обратите внимание, в режиме генерации
							в C доступны только кнопки 'Ввод' и 'Вправо'!</td>
				</tr>
			</table>

			<h4><a name="nxt-drawing-blocks">Рисование на дисплее</a></h4>

			<p>
			Блоки рисования на дисплее работают только при прошивке программы на робот или в двумерной модели, при интерпретации программы по Bluetooth или USB они работать не будут в силу ограничений в системе прямых команд робота.
			</p>

			<table cellspacing="2" border="1" cellpadding="5" width="800" >
				<tr>
					<td><b>Название элемента</b></td>
					<td><b>Пиктограмма</b></td>
					<td><b>Описание</b></td>
				</tr>
				<tr>
					<td>Нарисовать прямоугольник</td>
					<td><center><img src="pics/nxt/drawRectangle.png" alt="Нарисовать прямоугольник"></center></td>
					<td>Нарисовать на экране прямоугольник. В качестве параметров указываются координаты левого верхнего угла, ширина и высота прямоугольника.</td>
				</tr>
				<tr>
					<td>Нарисовать точку</td>
					<td><center><img src="pics/nxt/drawPoint.png" alt="Нарисовать точку"></center></td>
					<td>Нарисовать на экране точку в указанных координатах.</td>
				</tr>
				<tr>
					<td>Нарисовать линию</td>
					<td><center><img src="pics/nxt/drawLine.png" alt="Нарисовать линию"></center></td>
					<td>Нарисовать на экране отрезок. В качестве параметров блоку указываются концы отрезка.</td>
				</tr>
				<tr>
					<td>Нарисовать круг</td>
					<td><center><img src="pics/nxt/drawCircle.png" alt="Нарисовать круг"></center></td>
					<td>Нарисовать на экране круг с заданным центром и заданным радиусом.</td>
				</tr>
				<tr>
					<td>Напечатать текст</td>
					<td><center><img src="pics/nxt/displayText.png" alt="Напечатать текст"></center></td>
					<td>Печатает заданную строку в заданном месте на экране робота. Значение свойства "Текст" по умолчанию трактуется как строка в чистом виде, оно так и будет выведено на экран. Чтобы система считала, что это выражение на текстовом языке (это может быть полезно, например, при отладке значения переменных), поставьте галочку "Вычислять" в редакторе свойств.</td>
				</tr>
				<tr>
					<td>Очистить экран</td>
					<td><center><img src="pics/nxt/clearScreen.png" alt="Очистить экран"></center></td>
					<td>Стереть всё, что нарисовано на экране.</td>
				</tr>
			</table>

			<p>
			Описание блоков, общих для всех конструкторов, можно посмотреть в разделе <a href="programming.html#blocks">Создание программ/Создание блоков</a>.
			</p>

			<h3><a name="sensor-variables">Сенсорные переменные</a></h3>

			<table cellspacing="2" border="1" cellpadding="5" width="800" >
				<tr>
					<td><b>Название</b></td>
					<td><b>Описание</b></td>
				</tr>
				<tr>
					<td>encoderA, encoderB, encoderC</td>
					<td>Показания экодера на порту A, B или C соответственно.</td>
				</tr>
				<tr>
					<td>buttonEnter, buttonEscape, buttonLeft, buttonRight</td>
					<td>Состояние кнопок на корпусе робота: кнопки "Ввод", "Отмена", "Влево", "Вправо" соответственно.
							0 соответствует ненажатой кнопке, 1 – нажатой. Обратите внимание, в режиме генерации
							в C доступны только кнопки 'Enter' и 'Right'!</td>
				</tr>
				<tr>
					<td>sensor1, sensor2, sensor3, sensor4</td>
					<td>Показания датчиков на портах 1, 2, 3, 4 соответственно.</td>
				</tr>
			</table>

			<h3><a name="textual-programming">Текстовое программирование</a></h3>

			<p>
			Текстовое программирование для Lego NXT осуществляется на языке C с использованием макросов и функций из библиотеки ECRobot. Общая структура программы такова:
			<ul>
				<li>Сначала идёт подключение заголовочных файлов, используемых в программе (стандартные заголовочные файлы C и заголовочные файлы ECRobot)</li>
				<li>Затем идёт объявление констант и переменных, используемых в программе</li>
				<li>За ними описываются функции ecrobot_device_initialize и ecrobot_device_terminate, первая вызывается при запуске программы, вторая - при прекращении её работы. В них обычно выполняется инициализация и деинициализация датчиков, энкодеров и других устройств робота. По умолчанию в ecrobot_device_initialize инициализируется генератор случайных чисел.</li>
				<li>За ними идёт описание функции user_1ms_isr_type2, которая вызывается каждую миллисекунду.</li>
				<li>Затем идёт описание задачи, которая запускается на исполнение при старте программы: TASK(OSEK_Task_Number_0). Здесь, собственно, и выполняется большая часть программирования.</li>
			</ul>
			</p>

			<p>
			Пример пустой, но содержащей все необходимые разделы программы приведён ниже:
			</p>

			<pre>
#include &lt;string.h>
#include "kernel.h"
#include "kernel_id.h"
#include "ecrobot_interface.h"
#include "trik_studio_utils.h"
#include &lt;time.h>
#include &lt;stdlib.h>
#include &lt;stdio.h>
#include &lt;stdarg.h>
#include &lt;math.h>

U32 __interpretation_started_timestamp__ = 0;
static const float pi = 3.14159265;



void ecrobot_device_initialize(void)
{
	srand(systick_get_ms());

}

void ecrobot_device_terminate(void)
{

}

/* nxtOSEK hook to be invoked from an ISR in category 2 */
void user_1ms_isr_type2(void)
{

}

/* Main task */
TASK(TASK_MAIN)
{
	__interpretation_started_timestamp__ = systick_get_ms();

	TerminateTask();
}
			</pre>

			<p>
			Полное описание (на английском) функций, доступных при программировании доступно по ссылке <a href="http://lejos-osek.sourceforge.net/api.htm">http://lejos-osek.sourceforge.net/api.htm</a>. См. также <a href="http://lejos-osek.sourceforge.net/index.htm">http://lejos-osek.sourceforge.net/index.htm</a>. В качестве примеров можно использовать код, генерируемый по диаграммам самой средой TRIKStudio.
			</p>

			<h3><a name="run-programs">Запуск программ</a></h3>

			<p>
			Для Lego NXT существует несколько вариантов выполнения программ:
			<ul>
			  <li>пошаговая интерпретация диаграммы с посылкой команд в робота по Bluetooth или USB, или моделированием поведения робота с помощью двумерной модели</li>
			  <li>прошивка и дальнейшее автономное исполнение программы на роботе без связи с компьютером.</li>
			</ul>
			</p>

			<h4><a name="run-programs-bluetooth">Интерпретация по Bluetooth</a></h4>

			<p>
			Чтобы запустить программу на выполнение, необходимо нажать кнопку "Выполнить" панели "Интерпретатор" или меню "Инструменты":
			</p>

			<center><img src="pics/nxt/execute-toolbar.png" alt="Запуск программы"></center>

			<p>
			После этого интерпретатор ищет блок "Начало", с которого и начинается выполнение программы. Если такой блок на диаграмме не найден, будет выдано сообщение об ошибке. Для каждого функционального блока должна существовать ровно одна исходящая связь, по которой выполнение программы перейдет к следующему блоку. В противном случае будет выдано сообщение об ошибке.
			</p>

			<p>
			Для того, чтобы остановить выполнение программы, нужно нажать кнопку "Прервать выполнение" панели "Интерпретатор" или меню "Инструменты".
			</p>

			<br />
			<h4><a name="run-programs-flashing">Прошивка в робота</a></h4>

			<p>
			Для прошивки программ в робота в TRIKStudio необходим дополнительный пакет инструментов, называемый NXTTools. Его может быть нужно доустановить с помощью менеджера пакетов (TRIKStudio/maintenance.exe), если он не был установлен изначально. Наличие NXTTools можно проверить по наличию кнопок "Генерировать код", "Прошить" и "Загрузить программу" на панели инструментов. Если кнопки есть, NXTTools установлен, если нет, загружать программу на робот нельзя:
			</p>

			<center><img src="pics/nxt/flash-toolbar.png" alt="Прошивка робота"></center>

			<p>
			Для того, чтобы запускать программы на роботе, вместо стандартной операционной системы Lego Mindstorms NXT 2.0 необходимо использовать прошивку nxtOSEK, которая является расширением стандартной системы, позволяющим сохранять программы с компьютера по USB и запускать их на роботе. Чтобы записать в робота прошивку nxtOSEK, необходимо подключить его по USB к компьютеру, перевести робота в режим перезагрузки (нажать и удерживать 4 секунды кнопку Reset на задней панели управляющего блока робота) и нажать в TRIKStudio кнопку "Прошить" панели инструментов "Взаимодействие с роботом":
			</p>

			<center><img src="pics/nxt/upload-osek-toolbar.png" alt="Кнопка 'Прошить'"></center>

			<p>
			Дождитесь информационного сообщения, подтверждающего завершение операции прошивки операционной системы. В случае неуспешного завершения убедитесь, что робот корректно подключен к компьютеру с помощью USB-провода и находится в режиме перезагрузки, после чего попробуйте перезаписать образ операционной системы еще раз.
			</p>


			<p>
			Когда прошивка успешно перезаписана, робот готов к загрузке на него и выполнению программ. Для этого нужно убедиться, что робот корректно подключен по USB к компьютеру и находится во включенном состоянии. После этого нужно нажать кнопку "Загрузить" панели инструментов "Взаимодействие с роботом". В редакторе диаграмм откроется дополнительная вкладка, на которой будет показан код на Си-подобном языке, поддерживаемом операционной системой nxtOSEK. Этот код будет скомпилирован в исполняемую программу и загружен в робота. При неудачном завершении операции будет выдано информационное сообщение, описывающее проблему.
			</p>
		</div>
		<!-- end #content -->
		<div style="clear: both;">&nbsp;</div>
	</div>
	<!-- end #page -->
</div>
<script type="text/javascript" src="footer.html.js"></script>
</body>
</html>
